name: Sync to Vercel Repository

on:
  push:
    branches:
      - main
      - master

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.VERCEL_REPO_TOKEN }}

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Remove .github directory (not needed for Vercel repo)
        run: |
          rm -rf .github

      - name: Configure Git for push
        run: |
          # Get the original commit author from the latest commit
          ORIGINAL_AUTHOR=$(git log -1 --format='%an')
          ORIGINAL_EMAIL=$(git log -1 --format='%ae')
          git config user.name "$ORIGINAL_AUTHOR"
          git config user.email "$ORIGINAL_EMAIL"
          git add -A
          git commit -m "Sync from junaid3321/amzdudes [skip vercel]" || echo "No changes to commit"

      - name: Add target repository as remote
        run: |
          git remote add target https://x-access-token:${{ secrets.VERCEL_REPO_TOKEN }}@github.com/amzdudesai02-rgb/amzdudes.git

      - name: Verify repository access
        run: |
          git ls-remote target || echo "Repository not accessible. Please check if repository exists and token has access."

      - name: Push to target repository
        run: |
          git push target HEAD:main --force
        env:
          GIT_ASKPASS: echo
          GIT_TERMINAL_PROMPT: 0

